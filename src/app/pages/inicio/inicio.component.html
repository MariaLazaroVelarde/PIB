<div
  class="min-h-screen bg-gradient-to-br from-purple-600 to-purple-800 text-white"
>
  <!-- Header móvil -->
  <div class="flex items-center justify-between p-4 pt-8 safe-area-top">
    <div class="flex items-center space-x-3">
      <div class="relative">
        <img
          [src]="usuario.avatar"
          alt="Avatar"
          class="w-12 h-12 rounded-full border-2 border-white/30 tap-animation"
        />
        <div
          class="absolute -bottom-1 -right-1 w-4 h-4 bg-green-400 rounded-full border-2 border-white"
        ></div>
      </div>
      <div (click)="simularNuevaNotificacion()" class="tap-animation">
        <p class="text-sm opacity-90">Hola,</p>
        <p class="font-semibold text-lg">{{ usuario.nombre }}</p>
        <p class="text-xs opacity-75">Toca para simular notificación</p>
      </div>
    </div>
    <div class="relative">
      <button
        (click)="toggleNotificaciones()"
        class="p-3 rounded-full bg-white/10 backdrop-blur-sm tap-animation haptic-light hover:bg-white/20 transition-colors"
      >
        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
          <path
            d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"
          />
        </svg>
        <div
          *ngIf="tieneNotificacionesNoLeidas()"
          class="absolute top-2 right-2 w-3 h-3 bg-red-500 rounded-full animate-pulse border border-white"
        ></div>
        <div
          *ngIf="tieneNotificacionesNoLeidas()"
          class="absolute top-1 right-1 w-2 h-2 bg-red-600 rounded-full text-xs text-white flex items-center justify-center font-bold"
        >
          {{ contarNotificacionesNoLeidas() }}
        </div>
      </button>
    </div>
  </div>

  <!-- Saldo disponible -->
  <div class="px-4 mb-6">
    <div
      class="card-mobile bg-white rounded-3xl p-6 border border-gray-200 shadow-2xl"
    >
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center space-x-2">
          <p class="text-sm font-medium text-gray-700">Saldo disponible</p>
          <div *ngIf="isConnected" class="flex items-center space-x-1">
            <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
            <span class="text-xs text-green-600 font-medium">MetaMask</span>
          </div>
        </div>
        <div class="flex items-center space-x-2">
          <button
            *ngIf="isConnected"
            (click)="refreshBalance()"
            class="p-2 rounded-full bg-gray-100 tap-animation haptic-light hover:bg-gray-200 transition-colors"
          >
            <svg
              class="w-4 h-4 text-gray-600"
              fill="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"
              />
            </svg>
          </button>
          <button
            (click)="toggleSaldoVisible()"
            class="p-2 rounded-full bg-gray-100 tap-animation haptic-light hover:bg-gray-200 transition-colors"
          >
            <svg
              class="w-4 h-4 transition-transform duration-200 text-gray-600"
              [class.rotate-180]="!saldoVisible"
              fill="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"
              />
            </svg>
          </button>
        </div>
      </div>

      <!-- Balance de MetaMask -->
      <div *ngIf="isConnected" class="mb-6">
        <div class="flex items-center justify-between mb-2">
          <p
            class="text-5xl font-black tracking-tight text-black"
            [class.blur-sm]="!saldoVisible"
            [class.select-none]="!saldoVisible"
          >
            <span *ngIf="saldoVisible">S/ {{ balance }}</span>
            <span *ngIf="!saldoVisible" class="text-gray-400">••••• ETH</span>
          </p>
        </div>
        <div class="flex items-center justify-between">
          <p class="text-sm text-gray-600 font-medium">
            Wallet: {{ getShortAddress() }}
          </p>
          <p class="text-xs text-green-600 font-medium">Actualizado ahora</p>
        </div>
      </div>

      <!-- Saldo tradicional (cuando no está conectado MetaMask) -->
      <div *ngIf="!isConnected" class="mb-6">
        <p
          class="text-5xl font-black tracking-tight text-black"
          [class.blur-sm]="!saldoVisible"
          [class.select-none]="!saldoVisible"
        >
          <span *ngIf="saldoVisible"
            >S/ {{ (usuario.saldo || 0).toFixed(2) }}</span
          >
          <span *ngIf="!saldoVisible" class="text-gray-400">S/ ••••••</span>
        </p>
        <div class="flex items-center justify-between mt-2">
          <p class="text-sm text-gray-600 font-medium">Saldo tradicional</p>
          <button
            (click)="navegarA('/login')"
            class="text-xs text-purple-600 hover:text-purple-800 font-medium"
          >
            Conectar MetaMask
          </button>
        </div>
      </div>

      <!-- Botones de acción móviles -->
      <div class="grid grid-cols-4 gap-3">
        <button
          (click)="navegarA('/enviar-dinero')"
          class="btn-mobile flex flex-col items-center p-4 rounded-2xl bg-blue-500/90 backdrop-blur-sm tap-animation haptic-light"
        >
          <svg class="w-7 h-7 mb-2" fill="currentColor" viewBox="0 0 24 24">
            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" />
          </svg>
          <span class="text-xs font-semibold">Enviar</span>
        </button>

        <button
          (click)="navegarA('/mi-qr')"
          class="btn-mobile flex flex-col items-center p-4 rounded-2xl bg-green-500/90 backdrop-blur-sm tap-animation haptic-light"
        >
          <svg class="w-7 h-7 mb-2" fill="currentColor" viewBox="0 0 24 24">
            <path
              d="M3 11h8V3H3v8zm2-6h4v4H5V5zM13 3v8h8V3h-8zm6 6h-4V5h4v4zM3 21h8v-8H3v8zm2-6h4v4H5v-4z"
            />
          </svg>
          <span class="text-xs font-semibold">Mi QR</span>
        </button>

        <button
          (click)="mostrarProximamente()"
          class="btn-mobile flex flex-col items-center p-4 rounded-2xl bg-orange-500/90 backdrop-blur-sm tap-animation haptic-light"
        >
          <svg class="w-7 h-7 mb-2" fill="currentColor" viewBox="0 0 24 24">
            <path
              d="M7 4V2C7 1.45 7.45 1 8 1S9 1.45 9 2V4H15V2C15 1.45 15.45 1 16 1S17 1.45 17 2V4H20C21.1 4 22 4.9 22 6V20C22 21.1 21.1 22 20 22H4C2.9 22 2 21.1 2 20V6C2 4.9 2.9 4 4 4H7Z"
            />
          </svg>
          <span class="text-xs font-semibold">Recargar</span>
        </button>

        <button
          (click)="navegarA('/pagar')"
          class="btn-mobile flex flex-col items-center p-4 rounded-2xl bg-purple-500/90 backdrop-blur-sm tap-animation haptic-light"
        >
          <svg class="w-7 h-7 mb-2" fill="currentColor" viewBox="0 0 24 24">
            <path
              d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"
            />
          </svg>
          <span class="text-xs font-semibold">Más</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Panel de Notificaciones Overlay -->
  <div
    *ngIf="mostrarNotificaciones"
    class="fixed top-16 left-4 right-4 z-50 max-w-sm mx-auto"
  >
    <div
      class="bg-white rounded-2xl shadow-2xl border border-gray-200 max-h-96 overflow-hidden"
    >
      <!-- Header del panel -->
      <div
        class="flex items-center justify-between p-4 border-b border-gray-100 bg-gradient-to-r from-purple-50 to-blue-50"
      >
        <h3 class="font-bold text-gray-900">Notificaciones</h3>
        <div class="flex items-center space-x-2">
          <button
            (click)="marcarTodasComoLeidas()"
            class="text-xs text-purple-600 font-medium hover:text-purple-800 tap-animation"
          >
            Marcar todas
          </button>
          <button
            (click)="cerrarNotificaciones()"
            class="p-1 rounded-full hover:bg-gray-100 tap-animation"
          >
            <svg
              class="w-4 h-4 text-gray-500"
              fill="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
              />
            </svg>
          </button>
        </div>
      </div>

      <!-- Lista de notificaciones -->
      <div class="max-h-80 overflow-y-auto">
        <div
          *ngFor="
            let notificacion of notificaciones;
            trackBy: trackByNotificacion
          "
          class="p-4 border-b border-gray-50 hover:bg-gray-50 transition-colors tap-animation"
          [class.bg-blue-50]="!notificacion.leida"
          (click)="marcarComoLeida(notificacion)"
        >
          <div class="flex items-start space-x-3">
            <!-- Icono de notificación -->
            <div
              class="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center"
              [class.bg-green-100]="notificacion.tipo === 'pago_recibido'"
              [class.bg-blue-100]="notificacion.tipo === 'pago_enviado'"
              [class.bg-orange-100]="notificacion.tipo === 'promocion'"
              [class.bg-purple-100]="notificacion.tipo === 'sistema'"
            >
              <svg
                class="w-4 h-4"
                fill="currentColor"
                viewBox="0 0 24 24"
                [class.text-green-600]="notificacion.tipo === 'pago_recibido'"
                [class.text-blue-600]="notificacion.tipo === 'pago_enviado'"
                [class.text-orange-600]="notificacion.tipo === 'promocion'"
                [class.text-purple-600]="notificacion.tipo === 'sistema'"
              >
                <path
                  *ngIf="notificacion.tipo === 'pago_recibido'"
                  d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
                />
                <path
                  *ngIf="notificacion.tipo === 'pago_enviado'"
                  d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"
                />
                <path
                  *ngIf="notificacion.tipo === 'promocion'"
                  d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"
                />
                <path
                  *ngIf="notificacion.tipo === 'sistema'"
                  d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
                />
              </svg>
            </div>

            <!-- Contenido de la notificación -->
            <div class="flex-1 min-w-0">
              <p class="font-semibold text-gray-900 text-sm truncate">
                {{ notificacion.titulo }}
              </p>
              <p class="text-gray-600 text-xs mt-1 line-clamp-2">
                {{ notificacion.mensaje }}
              </p>
              <div class="flex items-center justify-between mt-2">
                <p class="text-xs text-gray-400">{{ notificacion.tiempo }}</p>
                <div
                  *ngIf="!notificacion.leida"
                  class="w-2 h-2 bg-blue-500 rounded-full"
                ></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Estado vacío -->
        <div *ngIf="notificaciones.length === 0" class="p-8 text-center">
          <svg
            class="w-12 h-12 mx-auto text-gray-300 mb-3"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"
            />
          </svg>
          <p class="text-gray-500 font-medium text-sm">
            No tienes notificaciones
          </p>
          <p class="text-gray-400 text-xs mt-1">
            Te avisaremos cuando tengas algo nuevo
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Actividad reciente -->
  <div class="bg-white rounded-t-3xl flex-1 px-4 py-6 min-h-[400px]">
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-xl font-bold text-gray-900">Actividad reciente</h2>
      <button
        (click)="navegarA('/historial')"
        class="text-purple-600 font-semibold text-sm tap-animation haptic-light px-3 py-1 rounded-full bg-purple-50"
      >
        Ver todo
      </button>
    </div>

    <div class="space-y-3">
      <div
        *ngFor="
          let transaccion of actividadReciente;
          trackBy: trackByTransaccion
        "
        class="card-mobile flex items-center space-x-4 p-4 bg-gray-50/80 rounded-2xl border border-gray-100 tap-animation"
      >
        <div class="relative">
          <img
            [src]="transaccion.avatar"
            alt="Avatar"
            class="w-12 h-12 rounded-full border-2 border-white shadow-sm"
          />
          <div
            class="absolute -bottom-1 -right-1 w-4 h-4 rounded-full border-2 border-white"
            [class.bg-green-400]="transaccion.monto > 0"
            [class.bg-red-400]="transaccion.monto < 0"
          ></div>
        </div>
        <div class="flex-1 min-w-0">
          <p class="font-semibold text-gray-900 truncate">
            {{ transaccion.nombre }}
          </p>
          <p class="text-sm text-gray-600 truncate">
            {{ transaccion.descripcion }}
          </p>
          <p class="text-xs text-gray-400 mt-1">{{ transaccion.fecha }}</p>
        </div>
        <div class="text-right">
          <p
            class="font-bold text-lg"
            [class.text-red-500]="transaccion.monto < 0"
            [class.text-green-500]="transaccion.monto > 0"
          >
            {{ transaccion.monto > 0 ? "+" : "" }}S/
            {{ Math.abs(transaccion.monto).toFixed(2) }}
          </p>
          <div class="flex items-center justify-end mt-1">
            <div
              class="w-2 h-2 rounded-full mr-2"
              [class.bg-green-400]="transaccion.monto > 0"
              [class.bg-red-400]="transaccion.monto < 0"
            ></div>
            <span class="text-xs text-gray-500">
              {{ transaccion.monto > 0 ? "Recibido" : "Enviado" }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Estado vacío -->
    <div *ngIf="actividadReciente.length === 0" class="text-center py-12">
      <svg
        class="w-16 h-16 mx-auto text-gray-300 mb-4"
        fill="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
        />
      </svg>
      <p class="text-gray-500 font-medium">No hay transacciones recientes</p>
      <p class="text-gray-400 text-sm mt-1">Tus pagos aparecerán aquí</p>
    </div>
  </div>
</div>
